# 新年倒计时网站 - 项目规范与功能需求

## 项目概述
这是一个模仿 https://2026.xcodeman.com/ 的新年倒计时网站，具有动态烟花特效、背景音乐、倒计时器和弹幕祝福功能。

## 技术栈
- 纯前端：HTML + CSS + JavaScript
- Canvas 2D 实现烟花和星空效果
- Web Audio API 生成烟花爆炸音效
- CSS Animation 实现弹幕效果
- LocalStorage 持久化用户设置

---

## 核心功能需求

### 1. 烟花效果
- **完全模仿原网站**的烟花爆炸效果
- 支持多种烟花类型：球形、环形、双层、柳叶、菊花、棕榈、心形、星形
- **3D深度感**：不同烟花有远近之分，近处烟花更大更亮
- **粒子拖尾效果**：粒子有运动轨迹
- **粒子闪烁**：随机闪烁效果增加真实感
- **默认参数（原网站配置）**：
  - particleCount: 23000
  - particleSize: 0.8
  - fadeSpeed: 0.00482
  - explosionForce: 3.3975
  - hoverDuration: 1.5
  - gravity: 0.00265

### 2. 烟花模式
- **舒缓模式** 🌙：烟花一个接一个放，缓慢节奏，适合平时欣赏
- **激烈模式** 🎉：2-3个烟花快速连发，适合跨年倒数或激动时刻
- 用户可在设置面板中切换模式
- 支持键盘快捷键：1=舒缓模式，2=激烈模式

### 3. 定时切换
- 用户可设定在某个时间点自动切换烟花模式
- 例如：23:59 自动切换到激烈模式迎接新年
- 定时任务列表可增删管理

### 4. 音效系统
- **使用 Web Audio API 生成**深度爆炸音效（不是预录音频）
- 三层声音叠加：
  - 低频隆隆声（正弦波）
  - 白噪声爆裂声（带低通滤波器）
  - 短促咔嗒声（三角波）
- 音量可调节（0-1）
- 可一键开关音效

### 5. 交互功能
- **鼠标点击**：在点击位置爆炸烟花
- **鼠标跟随**：鼠标移动时有粒子跟随特效
- **空格键**：手动发射烟花
- **M键**：切换音效开关

### 6. 设置面板
- 点击右上角 ⚙️ 图标打开设置面板
- 设置面板与音量按钮**并列显示**，不重叠
- 面板内容：
  - **粒子设置**：粒子数量、粒子大小、淡出速度
  - **物理设置**：爆炸力度、悬停时间、重力
  - **深度音效**：启用开关、音量滑块
  - **重置按钮**：一键恢复默认值
  - **语言切换**：中文/English 双语支持
  - **模式选择**：舒缓/激烈模式切换
  - **定时切换**：添加/删除定时任务

### 7. 双语支持
- 设置面板支持中英文切换
- 所有文本标签都有对应翻译
- 用户语言偏好保存到 LocalStorage

### 8. 星空背景
- Canvas 实现动态星空效果
- 星星有远近大小之分
- 支持加速特效（boost）

### 9. 倒计时器
- 显示距离2026年的：天、时、分、秒
- 数字使用科技感字体（Orbitron）
- 到达新年时自动切换激烈模式并庆祝

### 10. 弹幕系统
- 预设祝福语随机飘过屏幕
- 用户输入愿望后以弹幕形式显示
- 用户弹幕有特殊高亮效果
- 弹幕分布均匀，不集中在某个区域

---

## UI/UX 要求

### 控制按钮
- 位于页面右上角
- 🔇/🔊 音量开关按钮
- ⚙️ 设置按钮
- 两个按钮**并列显示**，间距合适

### 设置面板样式
- 从右侧滑入
- 半透明磨砂玻璃效果
- 可折叠的分区（点击标题折叠/展开）
- 滑块显示当前数值
- 重置按钮使用红色调，易于辨识

### 整体风格
- 深色背景
- 紫色/青色渐变点缀
- 科技感字体
- 流畅的动画过渡

---

## 文件结构

```
happynewyear/
├── index.html          # 主页面
├── css/
│   └── style.css       # 样式文件
├── js/
│   ├── main.js         # 主逻辑
│   ├── fireworks.js    # 烟花系统
│   ├── starfield.js    # 星空背景
│   ├── countdown.js    # 倒计时
│   ├── danmaku.js      # 弹幕系统
│   ├── audio.js        # 音效系统
│   └── config.js       # 配置管理
├── DESIGN.md           # 设计文档
└── README.md           # 项目说明
```

---

## 关键实现细节

### 烟花粒子系统
- 每个烟花根据 particleCount / 100 计算实际粒子数
- 粒子使用 HSLA 颜色，支持色相变化
- 粒子有生命周期，透明度随时间降低
- 物理模拟包含重力和空气阻力

### 音效生成
- 使用 AudioContext 创建音频上下文
- DynamicsCompressor 防止爆音
- 多层音频使用不同的增益包络

### 配置持久化
- 使用 localStorage 保存用户设置
- 页面加载时自动恢复上次配置
- 重置功能清除自定义设置

---

## 快捷键汇总

| 按键 | 功能 |
|------|------|
| 空格 | 发射烟花 |
| M | 切换音效 |
| 1 | 舒缓模式 |
| 2 | 激烈模式 |
| ESC | 关闭设置面板 |

---

## 注意事项

1. **性能优化**：粒子数量虽然配置为23000，但每个烟花只使用其中一部分
2. **音频初始化**：需要用户交互后才能播放音频（浏览器策略）
3. **响应式设计**：适配不同屏幕尺寸
4. **无障碍**：按钮有 title 提示

---

*最后更新：2024-12-31*
